<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Entry Point Regulation</title>
  <meta content="NOTE" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-NOTE" rel="stylesheet" type="text/css">
  <meta content="Bikeshed 1.0.0" name="generator">
<style>/* style-md-lists */

            /* This is a weird hack for me not yet following the commonmark spec
               regarding paragraph and lists. */
            [data-md] > :first-child {
                margin-top: 0;
            }
            [data-md] > :last-child {
                margin-bottom: 0;
            }</style>
<style>/* style-counters */

            body {
                counter-reset: example figure issue;
            }
            .issue {
                counter-increment: issue;
            }
            .issue:not(.no-marker)::before {
                content: "Issue " counter(issue);
            }

            .example {
                counter-increment: example;
            }
            .example:not(.no-marker)::before {
                content: "Example " counter(example);
            }
            .invalid.example:not(.no-marker)::before,
            .illegal.example:not(.no-marker)::before {
                content: "Invalid Example" counter(example);
            }

            figure {
                counter-increment: figure;
            }
            figcaption:not(.no-marker)::before {
                content: "Figure " counter(figure);
            }</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-selflinks */

            .heading, .issue, .note, .example, li, dt {
                position: relative;
            }
            a.self-link {
                position: absolute;
                top: 0;
                left: calc(-1 * (3.5rem - 26px));
                width: calc(3.5rem - 26px);
                height: 2em;
                text-align: center;
                border: none;
                transition: opacity .2s;
                opacity: .5;
            }
            a.self-link:hover {
                opacity: 1;
            }
            .heading > a.self-link {
                font-size: 83%;
            }
            li > a.self-link {
                left: calc(-1 * (3.5rem - 26px) - 2em);
            }
            dfn > a.self-link {
                top: auto;
                left: auto;
                opacity: 0;
                width: 1.5em;
                height: 1.5em;
                background: gray;
                color: white;
                font-style: normal;
                transition: opacity .2s, background-color .2s, color .2s;
            }
            dfn:hover > a.self-link {
                opacity: 1;
            }
            dfn > a.self-link:hover {
                color: black;
            }

            a.self-link::before            { content: "¶"; }
            .heading > a.self-link::before { content: "§"; }
            dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-autolinks */

            .css.css, .property.property, .descriptor.descriptor {
                color: #005a9c;
                font-size: inherit;
                font-family: inherit;
            }
            .css::before, .property::before, .descriptor::before {
                content: "‘";
            }
            .css::after, .property::after, .descriptor::after {
                content: "’";
            }
            .property, .descriptor {
                /* Don't wrap property and descriptor names */
                white-space: nowrap;
            }
            .type { /* CSS value <type> */
                font-style: italic;
            }
            pre .property::before, pre .property::after {
                content: "";
            }
            [data-link-type="property"]::before,
            [data-link-type="propdesc"]::before,
            [data-link-type="descriptor"]::before,
            [data-link-type="value"]::before,
            [data-link-type="function"]::before,
            [data-link-type="at-rule"]::before,
            [data-link-type="selector"]::before,
            [data-link-type="maybe"]::before {
                content: "‘";
            }
            [data-link-type="property"]::after,
            [data-link-type="propdesc"]::after,
            [data-link-type="descriptor"]::after,
            [data-link-type="value"]::after,
            [data-link-type="function"]::after,
            [data-link-type="at-rule"]::after,
            [data-link-type="selector"]::after,
            [data-link-type="maybe"]::after {
                content: "’";
            }

            [data-link-type].production::before,
            [data-link-type].production::after,
            .prod [data-link-type]::before,
            .prod [data-link-type]::after {
                content: "";
            }

            [data-link-type=element],
            [data-link-type=element-attr] {
                font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
                font-size: .9em;
            }
            [data-link-type=element]::before { content: "<" }
            [data-link-type=element]::after  { content: ">" }

            [data-link-type=biblio] {
                white-space: pre;
            }</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="http://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Entry Point Regulation</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">W3C Working Group Note, <time class="dt-updated" datetime="2016-09-14">14 September 2016</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://www.w3.org/TR/2016/NOTE-EPR-1-20160914/">http://www.w3.org/TR/2016/NOTE-EPR-1-20160914/</a>
     <dt>Editor's Draft:
     <dd><a href="https://w3c.github.io/webappsec-epr/">https://w3c.github.io/webappsec-epr/</a>
     <dt>Version History:
     <dd><a href="https://github.com/w3c/webappsec-epr/commits/master/index.src.html">https://github.com/w3c/webappsec-epr/commits/master/index.src.html</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webappsec@w3.org?subject=%5BEPR%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a> with subject line “<kbd>[EPR] <i data-lt="">… message topic …</i></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:drx@google.com">David Ross</a> (<span class="p-org org">Google Inc.</span>)
     <dd class="editor p-author h-card vcard" data-editor-id="56384"><a class="p-name fn u-email email" href="mailto:mkwst@google.com">Mike West</a> (<span class="p-org org">Google Inc.</span>)
     <dt>Participate:
     <dd><span><a href="https://github.com/w3c/webappsec-epr/issues/new">File an issue</a> (<a href="https://github.com/w3c/webappsec-epr/issues">open issues</a>)</span>
    </dl>
   </div>
   <div data-fill-with="warning">
    <details class="annoying-warning" open="">
     <summary>Obsoletion Notice</summary>
     <p> This specification is not being actively maintained,
  	and should not be used as a guide for implementations.
  	It may be revived in the future,
  	but for now should be considered obsolete. </p>
     <p> If you have questions or comments on this specification,
  	please send an email to the editors. </p>
    </details>
   </div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2016 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>This Note provides a historical reference for a proposed mechansim

to mitigate the risk of reflected cross-site
scripting (XSS), cross-site script inclusion (XSSI), and cross-site request
forgery (CSRF) attacks by demarcating the areas of an application which are
intended to be externally referencable.  A specified policy is applied on
external requests for all non-demarcated resources.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status"> <strong> Work on this document has been discontinued and it should not be
		referenced or used as a basis for implementation. </strong> </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#goals"><span class="secno">1.1</span> <span class="content">Goals</span></a>
      <li><a href="#examples"><span class="secno">1.2</span> <span class="content">Examples</span></a>
     </ol>
    <li><a href="#key-concepts"><span class="secno">2</span> <span class="content">Key Concepts and Terminology</span></a>
    <li>
     <a href="#framework"><span class="secno">3</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#epr-header"><span class="secno">3.1</span> <span class="content">The <code>EPR</code> HTTP Response Header Field</span></a>
      <li>
       <a href="#manifest"><span class="secno">3.2</span> <span class="content">Entry Point Manifests</span></a>
       <ol class="toc">
        <li><a href="#manifest-epr"><span class="secno">3.2.1</span> <span class="content">The <code>epr</code> manifest member</span></a>
        <li><a href="#manifest-ruleset"><span class="secno">3.2.2</span> <span class="content">Ruleset</span></a>
        <li><a href="#manifest-behaviors"><span class="secno">3.2.3</span> <span class="content">Behaviors</span></a>
        <li><a href="#manifest-caching"><span class="secno">3.2.4</span> <span class="content">Caching</span></a>
       </ol>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">4</span> <span class="content">Processing Algorithms</span></a>
     <ol class="toc">
      <li><a href="#process-request"><span class="secno">4.1</span> <span class="content"> Process <var>request</var> </span></a>
      <li><a href="#default-policy"><span class="secno">4.2</span> <span class="content"> Default EPR policy </span></a>
      <li><a href="#process-epr-header"><span class="secno">4.3</span> <span class="content"> Process <var>response</var>’s <code>EPR</code> header </span></a>
      <li><a href="#matching"><span class="secno">4.4</span> <span class="content"> Does <var>request</var> match <var>rule</var>? </span></a>
      <li><a href="#reporting"><span class="secno">4.5</span> <span class="content"> Report <var>request</var> as an entrypoint violation </span></a>
     </ol>
    <li>
     <a href="#iana-considerations"><span class="secno">5</span> <span class="content">IANA Considerations</span></a>
     <ol class="toc">
      <li><a href="#iana-https"><span class="secno">5.1</span> <span class="content"> The <code>EPR</code> HTTP Request Header Field </span></a>
     </ol>
    <li><a href="#acknowledgements"><span class="secno">6</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section>
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is not normative.</em></p>
    <p>Entry Point Regulation intends to provide defense-in-depth against reflected
  cross-site scripting and other content injection (XSS), cross-site script
  inclusion (XSSI), and cross-site request forgery (CSRF) attacks.</p>
    <p>These attacks all rely on the fundamentally porous nature of the web: any
  addressable portion of an application can be requested by any third-party,
  with arbitrary <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-query">query</a> parameters and <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-fragment">fragment</a> identifiers. The user agent will happily issue such requests with all the
  authority granted to the user, which can result in a number of problems.</p>
    <p>If an author can limit incoming traffic to a strict set of well-audited entry
  points, web applications can reduce the risk these attacks present, and indeed
  some authors have taken steps to do so via server-side logic, single page
  application (SPA) frameworks, (and, soon, via Service Workers). Server-side
  techniques can be an effective solution, but have a number of drawbacks.
  Complexity to the side, they are prone to false-positive restrictions in cases
  where a user’s intent should override the author’s intent (bookmarked links,
  for instance).</p>
    <p>This document defines a browser-enforced mechanism which can be layered on top
  of an existing application without server-side modifications, providing the
  attack mitigation authors desire, while allowing user intent to trump brittle
  filters when possible.</p>
    <h3 class="heading settled" data-level="1.1" id="goals"><span class="secno">1.1. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h3>
    <p>The threat model EPR operates under assumes that the user is authenticated to
  various web applications and origins within a single browser, and that the user
	browses to web content that may be malicious.  Web content can freely make
	authenticated cross-origin requests, enabling XSS, CSRF, and XSSI attacks.
	While CSP has shown to be an effective approach to addressing XSS, the protection
	CSP provides is only as good as the policies web applications are able to put into
	place. In many cases enforcing optimally secure CSP policies has proven difficult,
  for example when web content needs to leverage JavaScript libraries requiring
  eval().  EPR provides a defense-in-depth option for authors to mitigate XSS
  while also providing a new opportunity to mitigate CSRF and XSSI attacks.</p>
    <p>After an author implements EPR for an origin, the following statements ought
  to hold:</p>
    <ol>
     <li data-md="">
      <p>Authors should be able to block incoming requests based on the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a> being requested. That is, a request for <code>/</code> might be allowed, while a request for <code>/api/logout.cgi</code> might be denied.</p>
      <p>Modifications might include stripping <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-query">query</a> and <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-fragment">fragment</a> data from the request’s URL, or stripping
  cookies and other authentication information.</p>
     <li data-md="">
      <p>Authors should be able to block or modify incoming requests that contain
  data (e.g. the URL might have <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-query">query</a> or <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-fragment">fragment</a> data, or the request might contain a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-body">body</a>) differently from requests that do not contain
  data.</p>
     <li data-md="">
      <p>Authors should be able to block or modify incoming requests based on the
  request’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-context">context</a>; that is, navigations create
  different attack surfaces than subresource inclusions, and should be
  treated differently.</p>
     <li data-md="">
      <p>Requests should be excluded from the above filters if the request
  originates from a same-origin source. That is, any page on <code>https://example.com/</code> may request any resource on that origin,
  while requests from <code>https://not-example.com/</code> would be
  restricted.</p>
     <li data-md="">
      <p>A user agent may choose to exclude other requests from the above filters
  in order to prioritize a user’s intent. For instance, URLs typed directly
  into the address bar or bookmarked URLs might skip filters entirely.</p>
    </ol>
    <h3 class="heading settled" data-level="1.2" id="examples"><span class="secno">1.2. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h3>
    <p>The developer of a web-based "Internet of Things" administration console
  would like to have a high degree of assurance that XSS and CSRF attacks will
  not affect users.  If such an attack were to occur it could allow attackers
  to turn users' home appliances on and off at will, or perform other actions
  with serious consequences.  Because of the pervasive nature of XSS and CSRF
  vulnerabilities, the developer had been considering creating only monolithic
  desktop and mobile applications as opposed to utilizing the web platform.
  While this would allow them to sidestep the security concerns inherent with
  the web platform, it is clearly not ideal for users.  Implementation of CSP
  seemed to present a solution, however a fully restrictive policy is not
  possible due to library compatibility requirements.</p>
    <p>The developer decides to implement Entry Point Regulation.  They create a
  manifest specifying a default policy to block external requests by default.
  The developer lists out each entry point path in their manifest.  Testing
  is first performed in report-only mode, and the blocking behavior is only
  enabled once the developer is comfortable with the behavior of EPR.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="key-concepts"><span class="secno">2. </span><span class="content">Key Concepts and Terminology</span><a class="self-link" href="#key-concepts"></a></h2>
    <p>EPR categorizes <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">requests</a> as follows:</p>
    <ol>
     <li> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="navigational-request">navigational request</dfn> if its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-context-frame-type">context frame
      type</a> is one of "<code>top-level</code>", "<code>auxiliary</code>",
      or "<code>nested</code>". Navigational requests load a resource into a
      context where markup will be rendered, meaning that they place an origin
      at risk of both XSS and CSRF attack. 
     <li> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="subresource-request">subresource request</dfn> if it is not a <a data-link-type="dfn" href="#connection-request" id="ref-for-connection-request-1">connection request</a>,
      and its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-context-frame-type">context frame type</a> is "<code>none</code>".
      Subresource requests cannot execute code directly, so the XSS risk is
      minimal, but they do present the risk of CSRF and XSSI. 
     <li> <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="connection-request">connection request</dfn> if its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-context">context</a> is one
      of "<code>beacon</code>", "<code>cspreport</code>",
      "<code>eventsource</code>", "<code>fetch</code>", "<code>ping</code>", or
      "<code>xmlhttprequest</code>". These connection types are distinguished
      from subresource requests only because of their flexibility
      (<code>POST</code> vs <code>GET</code>, etc) and their typical usage
      (API endpoints vs static resources). The risks are similar, but authors
      may wish to set different rules for these kinds of requests than they
      would for other subresource requests. 
    </ol>
    <p class="issue" id="issue-67842308"><a class="self-link" href="#issue-67842308"></a> In the interest of keeping manifest creation simple, we should consider
merging subresource and connection requests into a single category.
Navigations are susceptable to XSS, whereas this is not a concern for
subresource and connection requests.  If there isn’t a similar very specific
distinction between attacks that would involve subresource and connection
requests than we should merge them.</p>
    <p class="issue" id="issue-26e88471"><a class="self-link" href="#issue-26e88471"></a> It could make sense to split out IMAGE SRC, SCRIPT SRC, etc. requests.
It should be very easy for a manifest author to tag individual rules in
the manifest so that images would be available to IMG tags on a different
origin, but not SCRIPT tags.  If we can identify a very specific attack
scenario where this is useful then it makes sense to do this.</p>
    <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="epr-store">EPR store</dfn> is an opaque storage mechanism which offers a
  user agent the ability to save, retrieve, and modify <a data-link-type="dfn" href="#epr-manifest" id="ref-for-epr-manifest-1">EPR manifests</a> on
  a per-origin basis. The implementation is vendor-specific, and the interface
  provided is not exposed to the web.</p>
    <p>The Augmented Backus-Naur Form (ABNF) notation is specified in <a data-link-type="biblio" href="#biblio-rfc5234">[RFC5234]</a>.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="framework"><span class="secno">3. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
    <p>In a nutshell:</p>
    <ol>
     <li> UA requests a resource from <code>example.com</code> for the very
      first time. 
     <li>
       <code>example.com</code> responds with a document that has an <code><a data-link-type="dfn" href="#epr-http-response-header-field" id="ref-for-epr-http-response-header-field-1">EPR</a></code> header, which tells the UA that it should
      regulate entry points for the origin. 
      <p>As no <a data-link-type="dfn" href="#epr-manifest" id="ref-for-epr-manifest-2">EPR manifest</a>, and therefore no policy, is
      available for this request, a <a data-link-type="dfn" href="#default-epr-policy" id="ref-for-default-epr-policy-1">default EPR policy</a> will apply
      as described in <a href="#default-policy">§4.2 Default EPR policy</a>.</p>
      <p>Somewhere in Fetch after we have the headers, we’ll call out to <a href="#process-epr-header">§4.3 Process response’s EPR header</a> to take whatever actions we need to take
      here. This means we’ll grab an <a data-link-type="dfn" href="#epr-manifest" id="ref-for-epr-manifest-3">EPR manifest</a> file, and
      store it persistently for use in regulating future requests.</p>
     <li>
       Subsequent navigations and resource requests from <code>example.com</code> will run through <a href="#process-request">§4.1 Process request</a> to determine whether they <a data-link-type="dfn" href="#match" id="ref-for-match-1">match</a> the ruleset defined in the <a data-link-type="dfn" href="#epr-manifest" id="ref-for-epr-manifest-4">EPR manifest</a> we processed above. 
      <p>If they don’t match a ruleset, the user agent will take some action, as
      described in <a href="#manifest-behaviors">§3.2.3 Behaviors</a>.</p>
     <li> That’s it! 
    </ol>
    <h3 class="heading settled" data-level="3.1" id="epr-header"><span class="secno">3.1. </span><span class="content">The <code>EPR</code> HTTP Response Header Field</span><a class="self-link" href="#epr-header"></a></h3>
    <p>Servers may request the protections outlined in this document by sending an <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="EPR" data-noexport="" id="epr-http-response-header-field"><code>EPR</code> HTTP response header field</dfn> along
  with a response. This request is represented by the following ABNF:</p>
<pre>"EPR:" *<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5234#appendix-B.1">WSP</a> "1" *<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5234#appendix-B.1">WSP</a>
</pre>
    <p>User agent conformance details upon receipt of such a header are explained in <a href="#process-epr-header">§4.3 Process response’s EPR header</a>.</p>
    <h3 class="heading settled" data-level="3.2" id="manifest"><span class="secno">3.2. </span><span class="content">Entry Point Manifests</span><a class="self-link" href="#manifest"></a></h3>
    <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="epr-manifest">EPR manifest</dfn> is a JSON file containing entry point regulation
  policy data for an <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>.</p>
    <p>Servers which opt-in to EPR protections via the <code><a data-link-type="dfn" href="#epr-http-response-header-field" id="ref-for-epr-http-response-header-field-2">EPR</a></code> header
  MUST make a manifest file available via <a data-link-type="biblio" href="#biblio-manifest">[MANIFEST]</a>.  EPR rules are included
  in a manifest via the <code>epr_manifest</code> attribute.</p>
    <p class="issue" id="issue-c7ddcd0c"><a class="self-link" href="#issue-c7ddcd0c"></a> "epr_manifest" attribute inconsistent (?) with "epr" member as described
below.</p>
    <div class="example" id="example-ec0e8134">
     <a class="self-link" href="#example-ec0e8134"></a> 
<pre>{
  ...,
  "<a class="idl-code" data-link-type="dict-member" href="#dom-epr-manifest-epr" id="ref-for-dom-epr-manifest-epr-1">epr</a>": {
    "<a class="idl-code" data-link-type="dict-member" href="#dom-eprpolicy-reporturl" id="ref-for-dom-eprpolicy-reporturl-1">reportURL</a>": "https://example.com/reporting-endpoint",
    "<a class="idl-code" data-link-type="dict-member" href="#dom-eprpolicy-redirecturl" id="ref-for-dom-eprpolicy-redirecturl-1">redirectURL</a>": "https://example.com/",
    "<a class="idl-code" data-link-type="dict-member" href="#dom-eprpolicy-navigationbehavior" id="ref-for-dom-eprpolicy-navigationbehavior-1">navigationBehavior</a>": "<a data-link-type="dfn" href="#allowstrippedget" id="ref-for-allowstrippedget-1">allowStrippedGET</a>",
    "<a class="idl-code" data-link-type="dict-member" href="#dom-eprpolicy-subresourcebehavior" id="ref-for-dom-eprpolicy-subresourcebehavior-1">subresourceBehavior</a>": "<a data-link-type="dfn" href="#allowstrippedget" id="ref-for-allowstrippedget-2">allowStrippedGET</a>",
    "<a class="idl-code" data-link-type="dict-member" href="#dom-eprpolicy-rules" id="ref-for-dom-eprpolicy-rules-1">rules</a>": [
      {
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-path" id="ref-for-dom-eprrule-path-1">path</a>": "/",
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-types" id="ref-for-dom-eprrule-types-1">types</a>": [ "navigational" ],
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-allowdata" id="ref-for-dom-eprrule-allowdata-1">allowData</a>": false
      },
      {
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-regex" id="ref-for-dom-eprrule-regex-1">regex</a>": "^/\\d+$",
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-types" id="ref-for-dom-eprrule-types-2">types</a>": [ "navigational" ],
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-allowdata" id="ref-for-dom-eprrule-allowdata-2">allowData</a>": false
      },
      ...
      {
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-path" id="ref-for-dom-eprrule-path-2">path</a>": "/image",
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-types" id="ref-for-dom-eprrule-types-3">types</a>": [ "subresource" ],
        "<a class="idl-code" data-link-type="dict-member" href="#dom-eprrule-allowdata" id="ref-for-dom-eprrule-allowdata-3">allowData</a>": true
      },
    ]
  }
}
</pre>
    </div>
    <p class="issue" id="issue-eb6de00a"><a class="self-link" href="#issue-eb6de00a"></a> It isn’t clear that the EPR manifest ought to be part of an application
  manifest as defined in <a data-link-type="biblio" href="#biblio-manifest">[MANIFEST]</a>. We’ve lumped it in there at the moment
  because it seems worth trying out, but it’s not clear that the concepts
  (though similar) mesh as well as they need to.</p>
    <h4 class="heading settled" data-level="3.2.1" id="manifest-epr"><span class="secno">3.2.1. </span><span class="content">The <code>epr</code> manifest member</span><a class="self-link" href="#manifest-epr"></a></h4>
    <p>The policy data that makes up the <a data-link-type="dfn" href="#epr-manifest" id="ref-for-epr-manifest-5">EPR manifest</a> is delivered via an <dfn class="dfn-paneled idl-code" data-dfn-for="EPR Manifest" data-dfn-type="dict-member" data-export="" id="dom-epr-manifest-epr"><code>epr</code></dfn> member of an
  application manifest <a data-link-type="biblio" href="#biblio-manifest">[MANIFEST]</a>. This member’s value is an dictionary
  adhering to the following IDL:</p>
<pre class="idl def">enum <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-eprbehavior">EPRBehavior</dfn> {
  <dfn class="idl-code" data-dfn-for="EPRBehavior" data-dfn-type="enum-value" data-export="" data-lt="&quot;allow&quot;|allow" id="dom-eprbehavior-allow">"allow"<a class="self-link" href="#dom-eprbehavior-allow"></a></dfn>,
  <dfn class="idl-code" data-dfn-for="EPRBehavior" data-dfn-type="enum-value" data-export="" data-lt="&quot;block&quot;|block" id="dom-eprbehavior-block">"block"<a class="self-link" href="#dom-eprbehavior-block"></a></dfn>,
  <dfn class="idl-code" data-dfn-for="EPRBehavior" data-dfn-type="enum-value" data-export="" data-lt="&quot;redirect&quot;|redirect" id="dom-eprbehavior-redirect">"redirect"<a class="self-link" href="#dom-eprbehavior-redirect"></a></dfn>,
  <dfn class="idl-code" data-dfn-for="EPRBehavior" data-dfn-type="enum-value" data-export="" data-lt="&quot;omitCredentials&quot;|omitCredentials" id="dom-eprbehavior-omitcredentials">"omitCredentials"<a class="self-link" href="#dom-eprbehavior-omitcredentials"></a></dfn>,
  <dfn class="idl-code" data-dfn-for="EPRBehavior" data-dfn-type="enum-value" data-export="" data-lt="&quot;allowStrippedGET&quot;|allowStrippedGET" id="dom-eprbehavior-allowstrippedget">"allowStrippedGET"<a class="self-link" href="#dom-eprbehavior-allowstrippedget"></a></dfn>
};

dictionary <dfn class="idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-eprpolicy">EPRPolicy<a class="self-link" href="#dictdef-eprpolicy"></a></dfn> {
  USVString? <a class="idl-code" data-link-type="dict-member" data-type="USVString? " href="#dom-eprpolicy-reporturl" id="ref-for-dom-eprpolicy-reporturl-2">reportURL</a>;
  USVString? <a class="idl-code" data-link-type="dict-member" data-type="USVString? " href="#dom-eprpolicy-redirecturl" id="ref-for-dom-eprpolicy-redirecturl-2">redirectURL</a>;
  <a data-link-type="idl-name" href="#enumdef-eprbehavior" id="ref-for-enumdef-eprbehavior-1">EPRBehavior</a> <a class="idl-code" data-default="&quot;allowStrippedGET&quot;" data-link-type="dict-member" data-type="EPRBehavior " href="#dom-eprpolicy-navigationbehavior" id="ref-for-dom-eprpolicy-navigationbehavior-2">navigationBehavior</a> = "allowStrippedGET";
  <a data-link-type="idl-name" href="#enumdef-eprbehavior" id="ref-for-enumdef-eprbehavior-2">EPRBehavior</a> <a class="idl-code" data-default="&quot;allowStrippedGET&quot;" data-link-type="dict-member" data-type="EPRBehavior " href="#dom-eprpolicy-subresourcebehavior" id="ref-for-dom-eprpolicy-subresourcebehavior-2">subresourceBehavior</a> = "allowStrippedGET";
  sequence&lt;<a data-link-type="idl-name" href="#dictdef-eprrule" id="ref-for-dictdef-eprrule-1">EPRRule</a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<EPRRule> " href="#dom-eprpolicy-rules" id="ref-for-dom-eprpolicy-rules-2">rules</a>;
};
</pre>
    <dl>
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRPolicy" data-dfn-type="dict-member" data-export="" id="dom-eprpolicy-reporturl">reportURL</dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>, nullable</span>
     <dd>
       A URL to which violation reports will be sent. See <a href="#reporting">§4.5 Report request as an entrypoint violation</a> for user
      agent conformance requirements. 
      <p class="note" role="note">Note: Authors may use the <a data-link-type="dfn" href="#allow" id="ref-for-allow-1">allow</a> behavior to simulate a
      "report only" mode that does not actually modify incoming <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">requests</a> but does send reports back to the report URL.</p>
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRPolicy" data-dfn-type="dict-member" data-export="" id="dom-eprpolicy-redirecturl">redirectURL</dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>, nullable</span>
     <dd> A URL to redirect to when using the <a data-link-type="dfn" href="#redirect" id="ref-for-redirect-1">redirect</a> behavior. 
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRPolicy" data-dfn-type="dict-member" data-export="" id="dom-eprpolicy-navigationbehavior">navigationBehavior</dfn>, <span> of type <a data-link-type="idl-name" href="#enumdef-eprbehavior" id="ref-for-enumdef-eprbehavior-3">EPRBehavior</a>, defaulting to <code>"allowStrippedGET"</code></span>
     <dd> If a navigational request doesn’t <a data-link-type="dfn" href="#match" id="ref-for-match-2">match</a> <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-rules" id="ref-for-dom-eprpolicy-rules-3">rules</a></code>, this
      property defines the action the user agent will take. Detailed conformance
      requirements can be found in <a href="#process-request">§4.1 Process request</a>, and a high-level
      description of the behaviors can be found in <a href="#manifest-behaviors">§3.2.3 Behaviors</a>. 
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRPolicy" data-dfn-type="dict-member" data-export="" id="dom-eprpolicy-subresourcebehavior">subresourceBehavior</dfn>, <span> of type <a data-link-type="idl-name" href="#enumdef-eprbehavior" id="ref-for-enumdef-eprbehavior-4">EPRBehavior</a>, defaulting to <code>"allowStrippedGET"</code></span>
     <dd> If a non-navigational request doesn’t <a data-link-type="dfn" href="#match" id="ref-for-match-3">match</a> <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-rules" id="ref-for-dom-eprpolicy-rules-4">rules</a></code>, this
      property defines the action the user agent will take. Detailed conformance
      requirements can be found in <a href="#process-request">§4.1 Process request</a>, and a high-level
      description of the behaviors can be found in <a href="#manifest-behaviors">§3.2.3 Behaviors</a>. 
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRPolicy" data-dfn-type="dict-member" data-export="" id="dom-eprpolicy-rules">rules</dfn>, <span> of type sequence&lt;<a data-link-type="idl-name" href="#dictdef-eprrule" id="ref-for-dictdef-eprrule-2">EPRRule</a>></span>
     <dd> The ruleset which should be applied. Details are in <a href="#manifest-ruleset">§3.2.2 Ruleset</a>. 
    </dl>
    <h4 class="heading settled" data-level="3.2.2" id="manifest-ruleset"><span class="secno">3.2.2. </span><span class="content">Ruleset</span><a class="self-link" href="#manifest-ruleset"></a></h4>
    <p>EPR manifests define a set of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="rules">rules</dfn> for a site, governing a user
  agent’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#fetching">fetching</a> behavior for <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">requests</a> made to that site’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>. Each rule is scoped to a specific subset of an origin’s
  URLs via a path prefix or a regular expression. Incoming <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">requests</a> which do not match the ruleset (as defined in <a href="#matching">§4.4 Does request match rule?</a>) will be dealt
  with as defined in <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-navigationbehavior" id="ref-for-dom-eprpolicy-navigationbehavior-3">navigationBehavior</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-subresourcebehavior" id="ref-for-dom-eprpolicy-subresourcebehavior-3">subresourceBehavior</a></code>, as appropriate.</p>
    <p>The following IDL defines rules' syntax:</p>
<pre class="idl def">enum <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-eprrequesttype">EPRRequestType</dfn> {
  <dfn class="idl-code" data-dfn-for="EPRRequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;connection&quot;|connection" id="dom-eprrequesttype-connection">"connection"<a class="self-link" href="#dom-eprrequesttype-connection"></a></dfn>, <dfn class="idl-code" data-dfn-for="EPRRequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;navigational&quot;|navigational" id="dom-eprrequesttype-navigational">"navigational"<a class="self-link" href="#dom-eprrequesttype-navigational"></a></dfn>, <dfn class="idl-code" data-dfn-for="EPRRequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;subresource&quot;|subresource" id="dom-eprrequesttype-subresource">"subresource"<a class="self-link" href="#dom-eprrequesttype-subresource"></a></dfn>
};

dictionary <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-eprrule">EPRRule</dfn> {
  USVString? <a class="idl-code" data-link-type="dict-member" data-type="USVString? " href="#dom-eprrule-path" id="ref-for-dom-eprrule-path-3">path</a>;
  USVString? <a class="idl-code" data-link-type="dict-member" data-type="USVString? " href="#dom-eprrule-regex" id="ref-for-dom-eprrule-regex-2">regex</a>;
  sequence&lt;<a data-link-type="idl-name" href="#enumdef-eprrequesttype" id="ref-for-enumdef-eprrequesttype-1">EPRRequestType</a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<EPRRequestType> " href="#dom-eprrule-types" id="ref-for-dom-eprrule-types-4">types</a>;
  boolean <a class="idl-code" data-link-type="dict-member" data-type="boolean " href="#dom-eprrule-allowdata" id="ref-for-dom-eprrule-allowdata-4">allowData</a>;
};
</pre>
    <dl>
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRRule" data-dfn-type="dict-member" data-export="" id="dom-eprrule-path">path</dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>, nullable</span>
     <dd> A path prefix defining a <a data-link-type="dfn" href="#rules" id="ref-for-rules-1">rule</a>’s scope. See <a href="#matching">§4.4 Does request match rule?</a> for user
      agent conformance requirements. One <code class="idl"><a data-link-type="idl" href="#dom-eprrule-path" id="ref-for-dom-eprrule-path-4">path</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-eprrule-regex" id="ref-for-dom-eprrule-regex-3">regex</a></code> may be specified for a given rule, but not both. 
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRRule" data-dfn-type="dict-member" data-export="" id="dom-eprrule-regex">regex</dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>, nullable</span>
     <dd> A regular expression, defining a <a data-link-type="dfn" href="#rules" id="ref-for-rules-2">rule</a>’s scope. See <a href="#matching">§4.4 Does request match rule?</a> for user agent conformance requirements. One <code class="idl"><a data-link-type="idl" href="#dom-eprrule-path" id="ref-for-dom-eprrule-path-5">path</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-eprrule-regex" id="ref-for-dom-eprrule-regex-4">regex</a></code> may be specified for a given rule, but not both. 
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRRule" data-dfn-type="dict-member" data-export="" id="dom-eprrule-types">types</dfn>, <span> of type sequence&lt;<a data-link-type="idl-name" href="#enumdef-eprrequesttype" id="ref-for-enumdef-eprrequesttype-2">EPRRequestType</a>></span>
     <dd> A set of request types to which this rule applies: the values MUST be one
      or more of "<code>navigational</code>" (which encompasses <a data-link-type="dfn" href="#navigational-request" id="ref-for-navigational-request-1">navigational
      requests</a>), "<code>subresource</code>" (<a data-link-type="dfn" href="#subresource-request" id="ref-for-subresource-request-1">subresource requests</a>),
      or "<code>connection</code>" (<a data-link-type="dfn" href="#connection-request" id="ref-for-connection-request-2">connection requests</a>). See <a href="#matching">§4.4 Does request match rule?</a> for user agent conformance requirements. 
     <dt><dfn class="dfn-paneled idl-code" data-dfn-for="EPRRule" data-dfn-type="dict-member" data-export="" id="dom-eprrule-allowdata">allowData</dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-boolean">boolean</a></span>
     <dd>
       If <code>true</code>, then matching <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">requests</a>' <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a>s are allowed to contain non-empty <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-query">query</a> and <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-fragment">fragment</a> properties,
      and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">requests</a>' <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-body">body</a> may be non-null. 
      <p>See <a href="#process-request">§4.1 Process request</a> for user agent conformance requirements.</p>
    </dl>
    <h4 class="heading settled" data-level="3.2.3" id="manifest-behaviors"><span class="secno">3.2.3. </span><span class="content">Behaviors</span><a class="self-link" href="#manifest-behaviors"></a></h4>
    <p>If a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a> does not <a data-link-type="dfn" href="#match" id="ref-for-match-4">match</a> the ruleset defined in an <a data-link-type="dfn" href="#epr-manifest" id="ref-for-epr-manifest-6">EPR
  manifest</a>’s <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-rules" id="ref-for-dom-eprpolicy-rules-5">rules</a></code> property, then the user agent looks to
  either <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-navigationbehavior" id="ref-for-dom-eprpolicy-navigationbehavior-4">navigationBehavior</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-subresourcebehavior" id="ref-for-dom-eprpolicy-subresourcebehavior-4">subresourceBehavior</a></code> to determine what action to take.</p>
    <p>The following behaviors are defined (and, if none is explicitly specified,
  then <a data-link-type="dfn" href="#allowstrippedget" id="ref-for-allowstrippedget-3">allowStrippedGET</a> is used as a default):</p>
    <dl>
     <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="allow">allow</dfn>
     <dd> Allow the request without modification. This behavior may be used to
      put the user agent in a "report only" mode, where violations are reported
      (as described in <a href="#reporting">§4.5 Report request as an entrypoint violation</a>), but requests proceed without
      modification. 
     <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="block">block</dfn>
     <dd> Cancel the request entirely, returning a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error">network error</a>. 
     <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="redirect">redirect</dfn>
     <dd> Redirect the request to a specified URL. 
     <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="omitcredentials">omitCredentials</dfn>
     <dd> Drop cookies and other authentication properties of the request by
      setting it’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">credentials mode</a> to
      "<code>omit</code>". 
     <dt><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="allowstrippedget">allowStrippedGET</dfn>
     <dd>
       Allow <code>GET</code> requests, after setting its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">url</a>’s <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-fragment">fragment</a> and <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-query">query</a> properties to <code>null</code>. 
      <p><code>POST</code> and other request types will be canceled, returning a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error">network error</a>.</p>
    </dl>
    <p>User agent conformance requirements are defined in <a href="#process-request">§4.1 Process request</a>.</p>
    <h4 class="heading settled" data-level="3.2.4" id="manifest-caching"><span class="secno">3.2.4. </span><span class="content">Caching</span><a class="self-link" href="#manifest-caching"></a></h4>
    <p>EPR manifest files are cached as per standard policy served in HTTP headers.
Manifest files are removed if the user clears their browser cache, as is
any persistent indication that EPR has been enabled by the site (as may have
been indicated by a HTTP response header).  When a manifest file expires from
the cache, the user agent should attempt to download the manifest file again
when possible.  At minimum this should occur on the next request to the
EPR-enabled site.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="algorithms"><span class="secno">4. </span><span class="content">Processing Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
    <h3 class="heading settled" data-level="4.1" id="process-request"><span class="secno">4.1. </span><span class="content"> Process <var>request</var> </span><a class="self-link" href="#process-request"></a></h3>
    <ol>
     <li> Let <var>policy</var> be the policy retrieved from a user agent’s <a data-link-type="dfn" href="#epr-store" id="ref-for-epr-store-1">EPR
      store</a> for <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a>’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>. 
     <li>
       Let <var>rules</var> be the set of <a data-link-type="dfn" href="#rules" id="ref-for-rules-3">rules</a> contained in <var>policy</var>’s <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-rules" id="ref-for-dom-eprpolicy-rules-6">rules</a></code> property. 
      <p class="note" role="note">Note: <var>rules</var> may be the empty set if no rules are specified. In
      this case, the behavior specified in the policy’s <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-navigationbehavior" id="ref-for-dom-eprpolicy-navigationbehavior-5">navigationBehavior</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-subresourcebehavior" id="ref-for-dom-eprpolicy-subresourcebehavior-5">subresourceBehavior</a></code> will
      be applied to all incoming requests.</p>
     <li> Let <var>matched</var> be <code>false</code>. 
     <li>
       For each <var>rule</var> in <var>rules</var>, if <var>request</var> <a data-link-type="dfn" href="#match" id="ref-for-match-5">matches</a> <var>rule</var>: 
      <ol>
       <li> Set <var>matched</var> to <code>true</code>. 
       <li> Skip the remaining <a data-link-type="dfn" href="#rules" id="ref-for-rules-4">rules</a> in <var>rules</var>. 
      </ol>
     <li> If <var>matched</var> is <var>true</var>, return without modifying <var>request</var>. 
     <li>
       Otherwise, let <var>behavior</var> be the value of <var>policy</var>’s <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-navigationbehavior" id="ref-for-dom-eprpolicy-navigationbehavior-6">navigationBehavior</a></code> if <var>request</var> is a <a data-link-type="dfn" href="#navigational-request" id="ref-for-navigational-request-2">navigational request</a>, and <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-subresourcebehavior" id="ref-for-dom-eprpolicy-subresourcebehavior-6">subresourceBehavior</a></code> otherwise. 
      <p class="issue" id="issue-52662b74"><a class="self-link" href="#issue-52662b74"></a> Do we need a <code>connectionBehavior</code> property?</p>
     <li>
       Execute the steps associated with the value of <var>behavior</var> in the
      list below: 
      <dl>
       <dt><a data-link-type="dfn" href="#allow" id="ref-for-allow-2">allow</a>
       <dd>
        <ol>
         <li> Return without modifying the request. 
        </ol>
       <dt><a data-link-type="dfn" href="#block" id="ref-for-block-1">block</a>
       <dd>
        <ol>
         <li> Cancel the request, and return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error">network error</a>. 
        </ol>
       <dt><a data-link-type="dfn" href="#redirect" id="ref-for-redirect-2">redirect</a>
       <dd> Do not make the request to the original resource.  Redirect the
          user agent to the <code class="idl"><a data-link-type="idl" href="#dom-eprpolicy-redirecturl" id="ref-for-dom-eprpolicy-redirecturl-3">redirectURL</a></code>. 
       <dt><a data-link-type="dfn" href="#omitcredentials" id="ref-for-omitcredentials-1">omitCredentials</a>
       <dd>
        <ol>
         <li> Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">credentials mode</a> property to <code>omit</code>. 
         <li> Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a>’s <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-username">username</a> to the empty string, and <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-password">password</a> to <code>null</code>. 
        </ol>
       <dt><a data-link-type="dfn" href="#allowstrippedget" id="ref-for-allowstrippedget-4">allowStrippedGET</a>
       <dd>
        <ol>
         <li> If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method">method</a> is not <code>GET</code>, cancel the request, and return a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error">network
              error</a>. 
         <li> Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a>’s <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-fragment">fragment</a> and <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-query">query</a> parameters
              to <code>null</code>. 
        </ol>
      </dl>
     <li> Follow steps in <a href="#reporting">§4.5 Report request as an entrypoint violation</a>. 
     <li> Given <var>matched</var> is <var>false</var>, the user agent should
      initiate a new background manifest download.  It is possible that a
      policy author might make a mistake and deploy a policy that
      inappropriately blocks access to resources.  So initiating a new
      download when a policy action is applied prevents broken manifests
      from persisting in the cache.  The user agent may choose to
      implement heuristics so as to avoid excessive manifest download
      attempts.  For example, by never attempting to re-download a
      manifest more than once an hour. 
    </ol>
    <h3 class="heading settled" data-level="4.2" id="default-policy"><span class="secno">4.2. </span><span class="content"> Default EPR policy </span><a class="self-link" href="#default-policy"></a></h3>
    <p>A default policy MUST be applied when all of the following criteria are
  met:</p>
    <ul>
     <li>An EPR header has been received by the user agent indicating that the
    site site has opted-in to EPR.
     <li>No EPR manifest is currently available.  (Possibly because it hasn’t
    been downloaded yet, it failed to parse, etc.
     <li>The request is a <a data-link-type="dfn" href="#navigational-request" id="ref-for-navigational-request-3">navigational request</a>.
     <li>The request was initiated by a cross-origin web site, not by the
    user’s selection of a bookmark or by the user typing an address into the
    address bar.
    </ul>
    <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="default-epr-policy">default EPR policy</dfn> specifies the <a data-link-type="dfn" href="#allowstrippedget" id="ref-for-allowstrippedget-5">allowStrippedGET</a> behavior is applied to requests, preventing requests from containing data
  that would enable reflected or DOM-based XSS.</p>
    <p class="issue" id="issue-f83f65cd"><a class="self-link" href="#issue-f83f65cd"></a> Allow data on everything under a specific hardcoded path, in order to
  facilitate URLs sent in e-mail, etc.?</p>
    <p>The intent of the default EPR policy is to mitigate XSS (not CSRF) when no
  EPR policy is available yet.  Even when the user is not authenticated to
  a site, XSS is problematic because the attack may persist until the user
  has authenticated.  This is not the case with CSRF, and CSRF is not
  effective until the user has authenticated to a site, at which point it is
  much more likely that a policy has been downloaded.</p>
    <p class="note" role="note">Note: The original <a href="https://lists.w3.org/Archives/Public/public-webappsec/2014Nov/0018.html">proposal</a>.</p>
    <h3 class="heading settled" data-level="4.3" id="process-epr-header"><span class="secno">4.3. </span><span class="content"> Process <var>response</var>’s <code>EPR</code> header </span><a class="self-link" href="#process-epr-header"></a></h3>
    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> (<var>response</var>), this algorithm parses its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a> to extract an <code><a data-link-type="dfn" href="#epr-http-response-header-field" id="ref-for-epr-http-response-header-field-3">EPR</a></code> header field. If such a field is present as EPR: 1, the user agent MUST
  fetch and process an <a data-link-type="dfn" href="#epr-manifest" id="ref-for-epr-manifest-7">EPR manifest</a> from <var>response</var>’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> unless one or more of the following statements is true:</p>
    <ol>
     <li> <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-context">context</a> is <code>manifest</code> 
     <li> A manifest for this origin is already cached at the user agent. 
     <li> There is already a pending manifest request for the origin. 
    </ol>
    <p>Once EPR has been enabled for an origin due to the presence of EPR: 1 on
  a response, EPR is effectively enabled for all resources from this origin,
  persistently, even if these resources do not specify an EPR header.  To
  disable EPR, an origin must send an EPR: 0 header.  The EPR: 0 header is
  also persistent.</p>
    <p>To <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response">process response</a> <var>response</var>, execute the following steps:</p>
    <ol>
     <li> If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url">URL</a> is <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/mixedcontent/#a-priori-insecure-url"><i lang="la">a
      priori</i> insecure</a>, abort these steps. 
     <li>
       If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a> contains a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header">header</a> named <code><a data-link-type="dfn" href="#epr-http-response-header-field" id="ref-for-epr-http-response-header-field-4">EPR</a></code>, then: 
      <ol>
       <li> Let <var>manifest URL</var> be the manifest URL provided by <a data-link-type="biblio" href="#biblio-manifest">[MANIFEST]</a>. 
       <li> Let <var>request</var> be a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method">method</a> is <code>GET</code>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a> is <var>manifest URL</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-context-frame-type">context frame type</a> is <code>none</code>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-context">context</a> is <code>manifest</code>, and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">credentials mode</a> is <code>omit</code>. 
       <li> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#fetching">Fetch</a> <var>request</var>. 
       <li>
         To <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response">process response</a> for the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response">response</a> <var>manifest
          response</var>: 
        <ol>
         <li> Store the manifest in the user agent’s <a data-link-type="dfn" href="#epr-store" id="ref-for-epr-store-2">EPR Store</a>, keyed
              to <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url">URL</a>’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>. 
        </ol>
      </ol>
    </ol>
    <h3 class="heading settled" data-level="4.4" id="matching"><span class="secno">4.4. </span><span class="content"> Does <var>request</var> match <var>rule</var>? </span><a class="self-link" href="#matching"></a></h3>
    <p>A <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request">request</a> (<var>request</var>) is said to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="match">match</dfn> a <a data-link-type="dfn" href="#rules" id="ref-for-rules-5">rule</a> (<var>rule</var>) if the following algorithm returns <code>Matches</code>:</p>
    <ol>
     <li> If <var>request</var> is a <a data-link-type="dfn" href="#connection-request" id="ref-for-connection-request-3">connection request</a>, and
      "<code>connection</code>" is not contained in <var>rule</var>’s <code class="idl"><a data-link-type="idl" href="#dom-eprrule-types" id="ref-for-dom-eprrule-types-5">types</a></code> list, return <code>Does Not Match</code>. 
     <li> If <var>request</var> is a <a data-link-type="dfn" href="#navigational-request" id="ref-for-navigational-request-4">navigational request</a>, and
      "<code>navigational</code>" is not contained in <var>rule</var>’s <code class="idl"><a data-link-type="idl" href="#dom-eprrule-types" id="ref-for-dom-eprrule-types-6">types</a></code> list, return <code>Does Not Match</code>. 
     <li> If <var>request</var> is a <a data-link-type="dfn" href="#subresource-request" id="ref-for-subresource-request-2">subresource request</a>, and
      "<code>subresource</code>" is not contained in <var>rule</var>’s <code class="idl"><a data-link-type="idl" href="#dom-eprrule-types" id="ref-for-dom-eprrule-types-7">types</a></code> list, return <code>Does Not Match</code>. 
     <li>
       If <var>rule</var> has a <code class="idl"><a data-link-type="idl" href="#dom-eprrule-path" id="ref-for-dom-eprrule-path-6">path</a></code> property whose value is
      neither <code>null</code> nor <code>undefined</code>: 
      <ol>
       <li> Let <var>rule path</var> be <var>rule</var>’s <code class="idl"><a data-link-type="idl" href="#dom-eprrule-path" id="ref-for-dom-eprrule-path-7">path</a></code>. 
       <li> Let <var>exact match</var> be <code>false</code> if the final
          character of <var>rule path</var> is the U+002F SOLIDUS character
          (<code>/</code>), and <code>true</code> otherwise. 
       <li> Let <var>rule path list</var> be the result of splitting <var>rule
          path</var> on the U+002F SOLIDUS character (<code>/</code>). 
       <li> If <var>rule path list</var>’s length is greater than <var>url
          path list</var>’s length, return <code>Does Not Match</code>. 
       <li>
         For each <var>entry</var> in <var>rule path list</var>: 
        <ol>
         <li> <a data-link-type="dfn" href="http://www.w3.org/TR/url/#percent-decode">Percent decode</a> <var>entry</var>. 
         <li> <a data-link-type="dfn" href="http://www.w3.org/TR/url/#percent-decode">Percent decode</a> the first item in <var>url path list</var>. 
         <li> If <var>entry</var> is not an <a data-link-type="dfn" href="http://www.w3.org/TR/html5/infrastructure.html#ascii-case-insensitive">ASCII case-insensitive
              match</a> for the first item in <var>url path list</var>, return <code>Does Not Match</code> 
         <li> Pop the first item in <var>url path list</var> off the list. 
        </ol>
       <li> If <var>exact match</var> is <code>true</code>, and <var>url path
          list</var> is not empty, return <code>Does Not Match</code> 
      </ol>
     <li>
       If <var>rule</var> has a <code class="idl"><a data-link-type="idl" href="#dom-eprrule-regex" id="ref-for-dom-eprrule-regex-5">regex</a></code> property whose value is
      neither <code>null</code> nor <code>undefined</code>: 
      <ol>
       <li> Let <var>rule regex</var> be <var>rule</var>’s <code class="idl"><a data-link-type="idl" href="#dom-eprrule-regex" id="ref-for-dom-eprrule-regex-6">regex</a></code>. 
       <li>
         Let <var>url path</var> be the empty string, and for each <var>component</var> in <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a>’s <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-path">path</a>: 
        <ol>
         <li> Append the U+002F SOLIDUS character (<code>/</code>) to <var>url path</var>. 
         <li> Append <var>component</var> to <var>url path</var>. 
        </ol>
       <li>
         If <var>url path</var> does not <em>regex match</em> (TODO) <var>rule
          regex</var>, return <code>Does Not Match</code>. 
        <p class="issue" id="issue-e10703d8"><a class="self-link" href="#issue-e10703d8"></a> Need to have spec language for this. There’s surely a regex
          spec somewhere, right?
          DR: Can we just reference the ECMAScript spec?</p>
      </ol>
     <li>
       If <var>rule</var>’s <code class="idl"><a data-link-type="idl" href="#dom-eprrule-allowdata" id="ref-for-dom-eprrule-allowdata-5">allowData</a></code> is <code>false</code>, then
      return <code>Does Not Match</code> if any of the following statements
      are true: 
      <ol>
       <li> <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a>’s <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-fragment">fragment</a> property is not <code>null</code>. 
       <li> <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url">URL</a>’s <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-query">query</a> property is not <code>null</code>. 
       <li> <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-body">body</a> property is not <code>null</code>. 
      </ol>
     <li> Return <code>Matches</code>. 
    </ol>
    <h3 class="heading settled" data-level="4.5" id="reporting"><span class="secno">4.5. </span><span class="content"> Report <var>request</var> as an entrypoint violation </span><a class="self-link" href="#reporting"></a></h3>
    <p class="issue" id="issue-b412787b"><a class="self-link" href="#issue-b412787b"></a> We need to define violation reports. Steal something from CSP.</p>
    <p>Proposed format:</p>
    <p>{
    "epr-report": {
      "policy-fetch-time": Thu Apr 16 2015 14:23:46 GMT-0700 (PDT)
      "affected-uri": "http://example.org/page.html",
      "referrer": "http://evil.example.com/",
      "type": "navigational",
      "applied-behavior": "allowStrippedGET",
      "redirectedTo": ""
    }
  }</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="iana-considerations"><span class="secno">5. </span><span class="content">IANA Considerations</span><a class="self-link" href="#iana-considerations"></a></h2>
    <h3 class="heading settled" data-level="5.1" id="iana-https"><span class="secno">5.1. </span><span class="content"> The <code>EPR</code> HTTP Request Header Field </span><a class="self-link" href="#iana-https"></a></h3>
     The permanent message header field registry should be updated with the
  following registration <a data-link-type="biblio" href="#biblio-rfc3864">[RFC3864]</a>: 
    <dl>
     <dt>Header field name
     <dd>EPR
     <dt>Applicable protocol
     <dd>http
     <dt>Status
     <dd>standard
     <dt>Author/Change controller
     <dd>W3C
     <dt>Specification document
     <dd>This specification (See <a href="#epr-header">§3.1 The EPR HTTP Response Header Field</a>)
    </dl>
    <section>
     <h2 class="heading settled" data-level="6" id="acknowledgements"><span class="secno">6. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
     <p>Entry point regulation is an implementation of concepts introduced by Charlie
  Reis et al. in section 5 of <a data-link-type="biblio" href="#biblio-isolation">[ISOLATION]</a>.</p>
    </section>
   </section>
  </main>
  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-f839f6c8">
   <a class="self-link" href="#example-f839f6c8"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-eprbehavior-allow">"allow"</a><span>, in §3.2.1</span>
   <li>
    allow
    <ul>
     <li><a href="#dom-eprbehavior-allow">enum-value for EPRBehavior</a><span>, in §3.2.1</span>
     <li><a href="#allow">definition of</a><span>, in §3.2.3</span>
    </ul>
   <li><a href="#dom-eprrule-allowdata">allowData</a><span>, in §3.2.2</span>
   <li><a href="#dom-eprbehavior-allowstrippedget">"allowStrippedGET"</a><span>, in §3.2.1</span>
   <li>
    allowStrippedGET
    <ul>
     <li><a href="#dom-eprbehavior-allowstrippedget">enum-value for EPRBehavior</a><span>, in §3.2.1</span>
     <li><a href="#allowstrippedget">definition of</a><span>, in §3.2.3</span>
    </ul>
   <li><a href="#dom-eprbehavior-block">"block"</a><span>, in §3.2.1</span>
   <li>
    block
    <ul>
     <li><a href="#dom-eprbehavior-block">enum-value for EPRBehavior</a><span>, in §3.2.1</span>
     <li><a href="#block">definition of</a><span>, in §3.2.3</span>
    </ul>
   <li><a href="#dom-eprrequesttype-connection">"connection"</a><span>, in §3.2.2</span>
   <li><a href="#dom-eprrequesttype-connection">connection</a><span>, in §3.2.2</span>
   <li><a href="#connection-request">connection request</a><span>, in §2</span>
   <li><a href="#default-epr-policy">default EPR policy</a><span>, in §4.2</span>
   <li><a href="#epr-http-response-header-field">EPR</a><span>, in §3.1</span>
   <li><a href="#dom-epr-manifest-epr">epr</a><span>, in §3.2.1</span>
   <li><a href="#enumdef-eprbehavior">EPRBehavior</a><span>, in §3.2.1</span>
   <li><a href="#epr-http-response-header-field">EPR HTTP response header field</a><span>, in §3.1</span>
   <li><a href="#epr-manifest">EPR manifest</a><span>, in §3.2</span>
   <li><a href="#dictdef-eprpolicy">EPRPolicy</a><span>, in §3.2.1</span>
   <li><a href="#enumdef-eprrequesttype">EPRRequestType</a><span>, in §3.2.2</span>
   <li><a href="#dictdef-eprrule">EPRRule</a><span>, in §3.2.2</span>
   <li><a href="#epr-store">EPR store</a><span>, in §2</span>
   <li><a href="#match">match</a><span>, in §4.4</span>
   <li><a href="#dom-eprrequesttype-navigational">"navigational"</a><span>, in §3.2.2</span>
   <li><a href="#dom-eprrequesttype-navigational">navigational</a><span>, in §3.2.2</span>
   <li><a href="#navigational-request">navigational request</a><span>, in §2</span>
   <li><a href="#dom-eprpolicy-navigationbehavior">navigationBehavior</a><span>, in §3.2.1</span>
   <li><a href="#dom-eprbehavior-omitcredentials">"omitCredentials"</a><span>, in §3.2.1</span>
   <li>
    omitCredentials
    <ul>
     <li><a href="#dom-eprbehavior-omitcredentials">enum-value for EPRBehavior</a><span>, in §3.2.1</span>
     <li><a href="#omitcredentials">definition of</a><span>, in §3.2.3</span>
    </ul>
   <li><a href="#dom-eprrule-path">path</a><span>, in §3.2.2</span>
   <li>
    redirect
    <ul>
     <li><a href="#dom-eprbehavior-redirect">enum-value for EPRBehavior</a><span>, in §3.2.1</span>
     <li><a href="#redirect">definition of</a><span>, in §3.2.3</span>
    </ul>
   <li><a href="#dom-eprbehavior-redirect">"redirect"</a><span>, in §3.2.1</span>
   <li><a href="#dom-eprpolicy-redirecturl">redirectURL</a><span>, in §3.2.1</span>
   <li><a href="#dom-eprrule-regex">regex</a><span>, in §3.2.2</span>
   <li><a href="#dom-eprpolicy-reporturl">reportURL</a><span>, in §3.2.1</span>
   <li>
    rules
    <ul>
     <li><a href="#dom-eprpolicy-rules">dict-member for EPRPolicy</a><span>, in §3.2.1</span>
     <li><a href="#rules">definition of</a><span>, in §3.2.2</span>
    </ul>
   <li><a href="#dom-eprrequesttype-subresource">"subresource"</a><span>, in §3.2.2</span>
   <li><a href="#dom-eprrequesttype-subresource">subresource</a><span>, in §3.2.2</span>
   <li><a href="#dom-eprpolicy-subresourcebehavior">subresourceBehavior</a><span>, in §3.2.1</span>
   <li><a href="#subresource-request">subresource request</a><span>, in §2</span>
   <li><a href="#dom-eprrule-types">types</a><span>, in §3.2.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-body">body</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-context">context</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-context-frame-type">context frame type</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">credentials mode</a>
     <li><a href="https://fetch.spec.whatwg.org/#fetching">fetching</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-header">header</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response-header-list">header list</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-method">method</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-network-error">network error</a>
     <li><a href="https://fetch.spec.whatwg.org/#process-response">process response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request">request</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-response">response</a>
     <li><a href="https://fetch.spec.whatwg.org/#concept-request-url">url</a>
    </ul>
   <li>
    <a data-link-type="biblio">[html5]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/html5/infrastructure.html#ascii-case-insensitive">ascii case-insensitive match</a>
    </ul>
   <li>
    <a data-link-type="biblio">[mixed-content]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec/specs/mixedcontent/#a-priori-insecure-url">a priori insecure</a>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC5234]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc5234#appendix-B.1">wsp</a>
    </ul>
   <li>
    <a data-link-type="biblio">[rfc6454]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WHATWG-URL]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/url/#concept-url-fragment">fragment</a>
     <li><a href="http://www.w3.org/TR/url/#concept-url-password">password</a>
     <li><a href="http://www.w3.org/TR/url/#concept-url-path">path</a>
     <li><a href="http://www.w3.org/TR/url/#percent-decode">percent decode</a>
     <li><a href="http://www.w3.org/TR/url/#concept-url-query">query</a>
     <li><a href="http://www.w3.org/TR/url/#concept-url-username">username</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL2]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>
     <li><a href="https://heycam.github.io/webidl/#idl-boolean">boolean</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html5">[HTML5]
   <dd>Ian Hickson; et al. <a href="https://www.w3.org/TR/html5/">HTML5</a>. 28 October 2014. REC. URL: <a href="https://www.w3.org/TR/html5/">https://www.w3.org/TR/html5/</a>
   <dt id="biblio-manifest">[MANIFEST]
   <dd>Marcos Caceres; et al. <a href="https://w3c.github.io/manifest/">Manifest for a web application</a>. WD. URL: <a href="https://w3c.github.io/manifest/">https://w3c.github.io/manifest/</a>
   <dt id="biblio-mixed-content">[MIXED-CONTENT]
   <dd>Mike West. <a href="https://www.w3.org/TR/mixed-content/">Mixed Content</a>. 8 October 2015. CR. URL: <a href="https://www.w3.org/TR/mixed-content/">https://www.w3.org/TR/mixed-content/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc3864">[RFC3864]
   <dd>G. Klyne; M. Nottingham; J. Mogul. <a href="https://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>. September 2004. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc3864">https://tools.ietf.org/html/rfc3864</a>
   <dt id="biblio-rfc5234">[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a>
   <dt id="biblio-rfc6454">[RFC6454]
   <dd>A. Barth. <a href="https://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>. December 2011. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6454">https://tools.ietf.org/html/rfc6454</a>
   <dt id="biblio-webidl2">[WEBIDL2]
   <dd>Cameron McCormack; Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL (Second Edition)</a>. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
   <dt id="biblio-whatwg-url">[WHATWG-URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-isolation">[ISOLATION]
   <dd>Eric Y. Chen; et al. <a href="http://www.collinjackson.com/research/papers/appisolation.pdf">App Isolation: Get the Security of Multiple Browsers with Just One</a>. URL: <a href="http://www.collinjackson.com/research/papers/appisolation.pdf">http://www.collinjackson.com/research/papers/appisolation.pdf</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl def">enum <a href="#enumdef-eprbehavior">EPRBehavior</a> {
  <a href="#dom-eprbehavior-allow">"allow"</a>,
  <a href="#dom-eprbehavior-block">"block"</a>,
  <a href="#dom-eprbehavior-redirect">"redirect"</a>,
  <a href="#dom-eprbehavior-omitcredentials">"omitCredentials"</a>,
  <a href="#dom-eprbehavior-allowstrippedget">"allowStrippedGET"</a>
};

dictionary <a href="#dictdef-eprpolicy">EPRPolicy</a> {
  USVString? <a class="idl-code" data-link-type="dict-member" data-type="USVString? " href="#dom-eprpolicy-reporturl">reportURL</a>;
  USVString? <a class="idl-code" data-link-type="dict-member" data-type="USVString? " href="#dom-eprpolicy-redirecturl">redirectURL</a>;
  <a data-link-type="idl-name" href="#enumdef-eprbehavior">EPRBehavior</a> <a class="idl-code" data-default="&quot;allowStrippedGET&quot;" data-link-type="dict-member" data-type="EPRBehavior " href="#dom-eprpolicy-navigationbehavior">navigationBehavior</a> = "allowStrippedGET";
  <a data-link-type="idl-name" href="#enumdef-eprbehavior">EPRBehavior</a> <a class="idl-code" data-default="&quot;allowStrippedGET&quot;" data-link-type="dict-member" data-type="EPRBehavior " href="#dom-eprpolicy-subresourcebehavior">subresourceBehavior</a> = "allowStrippedGET";
  sequence&lt;<a data-link-type="idl-name" href="#dictdef-eprrule">EPRRule</a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<EPRRule> " href="#dom-eprpolicy-rules">rules</a>;
};

enum <a href="#enumdef-eprrequesttype">EPRRequestType</a> {
  <a href="#dom-eprrequesttype-connection">"connection"</a>, <a href="#dom-eprrequesttype-navigational">"navigational"</a>, <a href="#dom-eprrequesttype-subresource">"subresource"</a>
};

dictionary <a href="#dictdef-eprrule">EPRRule</a> {
  USVString? <a class="idl-code" data-link-type="dict-member" data-type="USVString? " href="#dom-eprrule-path">path</a>;
  USVString? <a class="idl-code" data-link-type="dict-member" data-type="USVString? " href="#dom-eprrule-regex">regex</a>;
  sequence&lt;<a data-link-type="idl-name" href="#enumdef-eprrequesttype">EPRRequestType</a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<EPRRequestType> " href="#dom-eprrule-types">types</a>;
  boolean <a class="idl-code" data-link-type="dict-member" data-type="boolean " href="#dom-eprrule-allowdata">allowData</a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> In the interest of keeping manifest creation simple, we should consider
merging subresource and connection requests into a single category.
Navigations are susceptable to XSS, whereas this is not a concern for
subresource and connection requests.  If there isn’t a similar very specific
distinction between attacks that would involve subresource and connection
requests than we should merge them.<a href="#issue-67842308"> ↵ </a></div>
   <div class="issue"> It could make sense to split out IMAGE SRC, SCRIPT SRC, etc. requests.
It should be very easy for a manifest author to tag individual rules in
the manifest so that images would be available to IMG tags on a different
origin, but not SCRIPT tags.  If we can identify a very specific attack
scenario where this is useful then it makes sense to do this.<a href="#issue-26e88471"> ↵ </a></div>
   <div class="issue"> "epr_manifest" attribute inconsistent (?) with "epr" member as described
below.<a href="#issue-c7ddcd0c"> ↵ </a></div>
   <div class="issue"> It isn’t clear that the EPR manifest ought to be part of an application
  manifest as defined in <a data-link-type="biblio" href="#biblio-manifest">[MANIFEST]</a>. We’ve lumped it in there at the moment
  because it seems worth trying out, but it’s not clear that the concepts
  (though similar) mesh as well as they need to.<a href="#issue-eb6de00a"> ↵ </a></div>
   <div class="issue"> Do we need a <code>connectionBehavior</code> property?<a href="#issue-52662b74"> ↵ </a></div>
   <div class="issue"> Allow data on everything under a specific hardcoded path, in order to
  facilitate URLs sent in e-mail, etc.?<a href="#issue-f83f65cd"> ↵ </a></div>
   <div class="issue"> Need to have spec language for this. There’s surely a regex
          spec somewhere, right?
          DR: Can we just reference the ECMAScript spec?<a href="#issue-e10703d8"> ↵ </a></div>
   <div class="issue"> We need to define violation reports. Steal something from CSP.<a href="#issue-b412787b"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="navigational-request">
   <b><a href="#navigational-request">#navigational-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigational-request-1">3.2.2. Ruleset</a>
    <li><a href="#ref-for-navigational-request-2">4.1. 
    Process request </a>
    <li><a href="#ref-for-navigational-request-3">4.2. 
    Default EPR policy </a>
    <li><a href="#ref-for-navigational-request-4">4.4. 
    Does request match rule? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="subresource-request">
   <b><a href="#subresource-request">#subresource-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-subresource-request-1">3.2.2. Ruleset</a>
    <li><a href="#ref-for-subresource-request-2">4.4. 
    Does request match rule? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="connection-request">
   <b><a href="#connection-request">#connection-request</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-connection-request-1">2. Key Concepts and Terminology</a>
    <li><a href="#ref-for-connection-request-2">3.2.2. Ruleset</a>
    <li><a href="#ref-for-connection-request-3">4.4. 
    Does request match rule? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="epr-store">
   <b><a href="#epr-store">#epr-store</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-epr-store-1">4.1. 
    Process request </a>
    <li><a href="#ref-for-epr-store-2">4.3. 
    Process response’s EPR header </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="epr-http-response-header-field">
   <b><a href="#epr-http-response-header-field">#epr-http-response-header-field</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-epr-http-response-header-field-1">3. Framework</a>
    <li><a href="#ref-for-epr-http-response-header-field-2">3.2. Entry Point Manifests</a>
    <li><a href="#ref-for-epr-http-response-header-field-3">4.3. 
    Process response’s EPR header </a> <a href="#ref-for-epr-http-response-header-field-4">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="epr-manifest">
   <b><a href="#epr-manifest">#epr-manifest</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-epr-manifest-1">2. Key Concepts and Terminology</a>
    <li><a href="#ref-for-epr-manifest-2">3. Framework</a> <a href="#ref-for-epr-manifest-3">(2)</a> <a href="#ref-for-epr-manifest-4">(3)</a>
    <li><a href="#ref-for-epr-manifest-5">3.2.1. The epr manifest member</a>
    <li><a href="#ref-for-epr-manifest-6">3.2.3. Behaviors</a>
    <li><a href="#ref-for-epr-manifest-7">4.3. 
    Process response’s EPR header </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-epr-manifest-epr">
   <b><a href="#dom-epr-manifest-epr">#dom-epr-manifest-epr</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-epr-manifest-epr-1">3.2. Entry Point Manifests</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-eprbehavior">
   <b><a href="#enumdef-eprbehavior">#enumdef-eprbehavior</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-eprbehavior-1">3.2.1. The epr manifest member</a> <a href="#ref-for-enumdef-eprbehavior-2">(2)</a> <a href="#ref-for-enumdef-eprbehavior-3">(3)</a> <a href="#ref-for-enumdef-eprbehavior-4">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprpolicy-reporturl">
   <b><a href="#dom-eprpolicy-reporturl">#dom-eprpolicy-reporturl</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprpolicy-reporturl-1">3.2. Entry Point Manifests</a>
    <li><a href="#ref-for-dom-eprpolicy-reporturl-2">3.2.1. The epr manifest member</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprpolicy-redirecturl">
   <b><a href="#dom-eprpolicy-redirecturl">#dom-eprpolicy-redirecturl</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprpolicy-redirecturl-1">3.2. Entry Point Manifests</a>
    <li><a href="#ref-for-dom-eprpolicy-redirecturl-2">3.2.1. The epr manifest member</a>
    <li><a href="#ref-for-dom-eprpolicy-redirecturl-3">4.1. 
    Process request </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprpolicy-navigationbehavior">
   <b><a href="#dom-eprpolicy-navigationbehavior">#dom-eprpolicy-navigationbehavior</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprpolicy-navigationbehavior-1">3.2. Entry Point Manifests</a>
    <li><a href="#ref-for-dom-eprpolicy-navigationbehavior-2">3.2.1. The epr manifest member</a>
    <li><a href="#ref-for-dom-eprpolicy-navigationbehavior-3">3.2.2. Ruleset</a>
    <li><a href="#ref-for-dom-eprpolicy-navigationbehavior-4">3.2.3. Behaviors</a>
    <li><a href="#ref-for-dom-eprpolicy-navigationbehavior-5">4.1. 
    Process request </a> <a href="#ref-for-dom-eprpolicy-navigationbehavior-6">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprpolicy-subresourcebehavior">
   <b><a href="#dom-eprpolicy-subresourcebehavior">#dom-eprpolicy-subresourcebehavior</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprpolicy-subresourcebehavior-1">3.2. Entry Point Manifests</a>
    <li><a href="#ref-for-dom-eprpolicy-subresourcebehavior-2">3.2.1. The epr manifest member</a>
    <li><a href="#ref-for-dom-eprpolicy-subresourcebehavior-3">3.2.2. Ruleset</a>
    <li><a href="#ref-for-dom-eprpolicy-subresourcebehavior-4">3.2.3. Behaviors</a>
    <li><a href="#ref-for-dom-eprpolicy-subresourcebehavior-5">4.1. 
    Process request </a> <a href="#ref-for-dom-eprpolicy-subresourcebehavior-6">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprpolicy-rules">
   <b><a href="#dom-eprpolicy-rules">#dom-eprpolicy-rules</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprpolicy-rules-1">3.2. Entry Point Manifests</a>
    <li><a href="#ref-for-dom-eprpolicy-rules-2">3.2.1. The epr manifest member</a> <a href="#ref-for-dom-eprpolicy-rules-3">(2)</a> <a href="#ref-for-dom-eprpolicy-rules-4">(3)</a>
    <li><a href="#ref-for-dom-eprpolicy-rules-5">3.2.3. Behaviors</a>
    <li><a href="#ref-for-dom-eprpolicy-rules-6">4.1. 
    Process request </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="rules">
   <b><a href="#rules">#rules</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-rules-1">3.2.2. Ruleset</a> <a href="#ref-for-rules-2">(2)</a>
    <li><a href="#ref-for-rules-3">4.1. 
    Process request </a> <a href="#ref-for-rules-4">(2)</a>
    <li><a href="#ref-for-rules-5">4.4. 
    Does request match rule? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-eprrequesttype">
   <b><a href="#enumdef-eprrequesttype">#enumdef-eprrequesttype</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-eprrequesttype-1">3.2.2. Ruleset</a> <a href="#ref-for-enumdef-eprrequesttype-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-eprrule">
   <b><a href="#dictdef-eprrule">#dictdef-eprrule</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-eprrule-1">3.2.1. The epr manifest member</a> <a href="#ref-for-dictdef-eprrule-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprrule-path">
   <b><a href="#dom-eprrule-path">#dom-eprrule-path</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprrule-path-1">3.2. Entry Point Manifests</a> <a href="#ref-for-dom-eprrule-path-2">(2)</a>
    <li><a href="#ref-for-dom-eprrule-path-3">3.2.2. Ruleset</a> <a href="#ref-for-dom-eprrule-path-4">(2)</a> <a href="#ref-for-dom-eprrule-path-5">(3)</a>
    <li><a href="#ref-for-dom-eprrule-path-6">4.4. 
    Does request match rule? </a> <a href="#ref-for-dom-eprrule-path-7">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprrule-regex">
   <b><a href="#dom-eprrule-regex">#dom-eprrule-regex</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprrule-regex-1">3.2. Entry Point Manifests</a>
    <li><a href="#ref-for-dom-eprrule-regex-2">3.2.2. Ruleset</a> <a href="#ref-for-dom-eprrule-regex-3">(2)</a> <a href="#ref-for-dom-eprrule-regex-4">(3)</a>
    <li><a href="#ref-for-dom-eprrule-regex-5">4.4. 
    Does request match rule? </a> <a href="#ref-for-dom-eprrule-regex-6">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprrule-types">
   <b><a href="#dom-eprrule-types">#dom-eprrule-types</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprrule-types-1">3.2. Entry Point Manifests</a> <a href="#ref-for-dom-eprrule-types-2">(2)</a> <a href="#ref-for-dom-eprrule-types-3">(3)</a>
    <li><a href="#ref-for-dom-eprrule-types-4">3.2.2. Ruleset</a>
    <li><a href="#ref-for-dom-eprrule-types-5">4.4. 
    Does request match rule? </a> <a href="#ref-for-dom-eprrule-types-6">(2)</a> <a href="#ref-for-dom-eprrule-types-7">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-eprrule-allowdata">
   <b><a href="#dom-eprrule-allowdata">#dom-eprrule-allowdata</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-eprrule-allowdata-1">3.2. Entry Point Manifests</a> <a href="#ref-for-dom-eprrule-allowdata-2">(2)</a> <a href="#ref-for-dom-eprrule-allowdata-3">(3)</a>
    <li><a href="#ref-for-dom-eprrule-allowdata-4">3.2.2. Ruleset</a>
    <li><a href="#ref-for-dom-eprrule-allowdata-5">4.4. 
    Does request match rule? </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="allow">
   <b><a href="#allow">#allow</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-allow-1">3.2.1. The epr manifest member</a>
    <li><a href="#ref-for-allow-2">4.1. 
    Process request </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="block">
   <b><a href="#block">#block</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-block-1">4.1. 
    Process request </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="redirect">
   <b><a href="#redirect">#redirect</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-redirect-1">3.2.1. The epr manifest member</a>
    <li><a href="#ref-for-redirect-2">4.1. 
    Process request </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="omitcredentials">
   <b><a href="#omitcredentials">#omitcredentials</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-omitcredentials-1">4.1. 
    Process request </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="allowstrippedget">
   <b><a href="#allowstrippedget">#allowstrippedget</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-allowstrippedget-1">3.2. Entry Point Manifests</a> <a href="#ref-for-allowstrippedget-2">(2)</a>
    <li><a href="#ref-for-allowstrippedget-3">3.2.3. Behaviors</a>
    <li><a href="#ref-for-allowstrippedget-4">4.1. 
    Process request </a>
    <li><a href="#ref-for-allowstrippedget-5">4.2. 
    Default EPR policy </a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="default-epr-policy">
   <b><a href="#default-epr-policy">#default-epr-policy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-epr-policy-1">3. Framework</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="match">
   <b><a href="#match">#match</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-match-1">3. Framework</a>
    <li><a href="#ref-for-match-2">3.2.1. The epr manifest member</a> <a href="#ref-for-match-3">(2)</a>
    <li><a href="#ref-for-match-4">3.2.3. Behaviors</a>
    <li><a href="#ref-for-match-5">4.1. 
    Process request </a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>